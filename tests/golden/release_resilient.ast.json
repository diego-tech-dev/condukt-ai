{
  "ast_version": "1.1",
  "goal": "ship resilient release",
  "types": {
    "DeployInput": [
      {
        "path": "dependencies.lint.status",
        "type": "str",
        "optional": false,
        "line": 7
      },
      {
        "path": "dependencies.test_suite.output.coverage",
        "type": "number",
        "optional": false,
        "line": 7
      },
      {
        "path": "dependencies.security_scan.output.critical",
        "type": "int",
        "optional": false,
        "line": 7
      }
    ],
    "DeployReport": [
      {
        "path": "release",
        "type": "str",
        "optional": false,
        "line": 8
      },
      {
        "path": "rollback_ready",
        "type": "bool",
        "optional": false,
        "line": 8
      },
      {
        "path": "risk",
        "type": "number",
        "optional": false,
        "line": 8
      }
    ],
    "LintReport": [
      {
        "path": "warnings",
        "type": "int",
        "optional": false,
        "line": 4
      },
      {
        "path": "status",
        "type": "str",
        "optional": false,
        "line": 4
      }
    ],
    "SecurityReport": [
      {
        "path": "critical",
        "type": "int",
        "optional": false,
        "line": 6
      },
      {
        "path": "high",
        "type": "int",
        "optional": false,
        "line": 6
      },
      {
        "path": "status",
        "type": "str",
        "optional": false,
        "line": 6
      }
    ],
    "TestReport": [
      {
        "path": "coverage",
        "type": "number",
        "optional": false,
        "line": 5
      },
      {
        "path": "tests_passed",
        "type": "int",
        "optional": false,
        "line": 5
      }
    ]
  },
  "constraints": [
    {
      "key": "risk",
      "op": "<=",
      "value": 0.2,
      "line": 12
    }
  ],
  "tasks": [
    {
      "name": "lint",
      "worker": "../workers/lint.py",
      "requires": [
        "ci"
      ],
      "after": [],
      "input_schema": [],
      "output_schema": [
        {
          "path": "warnings",
          "type": "int",
          "optional": false,
          "line": 23
        },
        {
          "path": "status",
          "type": "str",
          "optional": false,
          "line": 23
        }
      ],
      "line": 16
    },
    {
      "name": "test_suite",
      "worker": "../workers/test_suite.py",
      "requires": [
        "ci"
      ],
      "after": [],
      "input_schema": [],
      "output_schema": [
        {
          "path": "coverage",
          "type": "number",
          "optional": false,
          "line": 24
        },
        {
          "path": "tests_passed",
          "type": "int",
          "optional": false,
          "line": 24
        }
      ],
      "line": 17,
      "retries": 1,
      "backoff_seconds": 0.1
    },
    {
      "name": "security_scan",
      "worker": "../workers/security_scan.py",
      "requires": [
        "ci"
      ],
      "after": [],
      "input_schema": [],
      "output_schema": [
        {
          "path": "critical",
          "type": "int",
          "optional": false,
          "line": 25
        },
        {
          "path": "high",
          "type": "int",
          "optional": false,
          "line": 25
        },
        {
          "path": "status",
          "type": "str",
          "optional": false,
          "line": 25
        }
      ],
      "line": 18,
      "timeout_seconds": 10.0,
      "retries": 1,
      "backoff_seconds": 0.2
    },
    {
      "name": "deploy_prod",
      "worker": "../workers/deploy_prod.py",
      "requires": [
        "prod_access"
      ],
      "after": [
        "lint",
        "test_suite",
        "security_scan"
      ],
      "input_schema": [
        {
          "path": "dependencies.lint.status",
          "type": "str",
          "optional": false,
          "line": 26
        },
        {
          "path": "dependencies.test_suite.output.coverage",
          "type": "number",
          "optional": false,
          "line": 26
        },
        {
          "path": "dependencies.security_scan.output.critical",
          "type": "int",
          "optional": false,
          "line": 26
        }
      ],
      "output_schema": [
        {
          "path": "release",
          "type": "str",
          "optional": false,
          "line": 26
        },
        {
          "path": "rollback_ready",
          "type": "bool",
          "optional": false,
          "line": 26
        },
        {
          "path": "risk",
          "type": "number",
          "optional": false,
          "line": 26
        }
      ],
      "line": 19,
      "timeout_seconds": 20.0,
      "retries": 2,
      "backoff_seconds": 0.5
    }
  ],
  "verify": [
    {
      "line": 30,
      "expression": "lint.status == \"ok\""
    },
    {
      "line": 31,
      "expression": "test_suite.output.coverage >= 0.9"
    },
    {
      "line": 32,
      "expression": "security_scan.output.critical == 0"
    },
    {
      "line": 33,
      "expression": "deploy_prod.output.rollback_ready == true"
    }
  ]
}
