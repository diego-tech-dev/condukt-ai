{
  "ast_version": "1.1",
  "goal": "publish release from explicit artifacts",
  "types": {
    "PublishInput": [
      {
        "path": "artifacts.coverage",
        "type": "number",
        "optional": false,
        "line": 5
      }
    ],
    "PublishOutput": [
      {
        "path": "release_id",
        "type": "str",
        "optional": false,
        "line": 6
      },
      {
        "path": "quality_gate",
        "type": "str",
        "optional": false,
        "line": 6
      }
    ],
    "TestReport": [
      {
        "path": "coverage",
        "type": "number",
        "optional": false,
        "line": 4
      },
      {
        "path": "tests_passed",
        "type": "int",
        "optional": false,
        "line": 4
      }
    ]
  },
  "constraints": [
    {
      "key": "release_id",
      "op": "!=",
      "value": "",
      "line": 10
    }
  ],
  "tasks": [
    {
      "name": "test_suite",
      "worker": "../workers/test_suite.py",
      "requires": [
        "ci"
      ],
      "after": [],
      "input_schema": [],
      "output_schema": [
        {
          "path": "coverage",
          "type": "number",
          "optional": false,
          "line": 19
        },
        {
          "path": "tests_passed",
          "type": "int",
          "optional": false,
          "line": 19
        }
      ],
      "line": 14,
      "produces": [
        "coverage"
      ]
    },
    {
      "name": "publish_release",
      "worker": "../workers/publish_release.py",
      "requires": [
        "prod_access"
      ],
      "after": [
        "test_suite"
      ],
      "input_schema": [
        {
          "path": "artifacts.coverage",
          "type": "number",
          "optional": false,
          "line": 20
        }
      ],
      "output_schema": [
        {
          "path": "release_id",
          "type": "str",
          "optional": false,
          "line": 20
        },
        {
          "path": "quality_gate",
          "type": "str",
          "optional": false,
          "line": 20
        }
      ],
      "line": 15,
      "consumes": [
        "coverage"
      ],
      "produces": [
        "release_id"
      ]
    }
  ],
  "verify": [
    {
      "line": 24,
      "expression": "test_suite.status == \"ok\""
    },
    {
      "line": 25,
      "expression": "publish_release.status == \"ok\""
    },
    {
      "line": 26,
      "expression": "publish_release.output.quality_gate == \"high\""
    }
  ]
}
